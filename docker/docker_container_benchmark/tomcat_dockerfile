# FROM bellsoft/liberica-openjdk-debian:21-cds
FROM tomcat:10.1.35-jre21-temurin-noble

LABEL maintainer="Sagar Malla <sagarmalla08@gmail.com>"

# Environment variables
ENV CATALINA_HOME=/usr/local/tomcat
ENV JAVA_HOME=/opt/java/openjdk
# ENV JAVA_HOME=/usr/lib/jvm/jdk-21.0.9-bellsoft-x86_64
ENV PATH=$CATALINA_HOME/bin:$JAVA_HOME/bin:$PATH
ENV TZ=Asia/Kathmandu

# Install required packages
RUN apt-get update && apt-get install -y curl telnet tzdata && \
    ln -sf /usr/share/zoneinfo/$TZ /etc/localtime && \
    echo $TZ > /etc/timezone && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Install Tomcat
 RUN mkdir -p $CATALINA_HOME \
  && curl -SL https://archive.apache.org/dist/tomcat/tomcat-10/v10.1.44/bin/apache-tomcat-10.1.44.tar.gz \
  | tar -xz -C $CATALINA_HOME --strip-components=1

# ADD apache-tomcat-10.1.44.tar.gz /usr/local/.
# RUN mv /usr/local/apache-tomcat-10.1.44 $CATALINA_HOME
RUN echo "mallaas ll='ls -al'" >> /root/.bashrc

# Cleanup default webapps
RUN rm -rf $CATALINA_HOME/webapps/*

# Download sample WAR (optional)
# COPY ROOT.war $CATALINA_HOME/webapps/ROOT.war
RUN curl -SL https://tomcat.apache.org/tomcat-7.0-doc/appdev/sample/sample.war -o $CATALINA_HOME/webapps/ROOT.war

# Make scripts executable
RUN chmod +x $CATALINA_HOME/bin/*.sh

# Set working directory
WORKDIR $CATALINA_HOME

# Expose Tomcat port
EXPOSE 8080

ENTRYPOINT ["bash", "-c", "$CATALINA_HOME/bin/catmallana.sh run"]
